name: Android

on:
  workflow_dispatch:

jobs:
  android:
    runs-on: ubuntu-22.04

    steps:
      - name: Getting Updates and Installing Dependencies
        run: |
          sudo apt update -y
          sudo apt install -y aria2 wget lxde qemu-kvm qemu-utils websockify novnc tigervnc-standalone-server curl
          sudo mkdir -p /root/.vnc
          sudo wget -O /root/.vnc/xstartup https://raw.githubusercontent.com/Efebey2903/android-tailscale/main/xstartup
          sudo chmod +x /root/.vnc/xstartup
          sudo curl -fsSL https://tailscale.com/install.sh | sh
          sudo tailscale up --ssh

      - name: Download Android-x86 ISO and Create Virtual Disk
        run: |
          # t·∫£i ISO Android-x86 9.0 r2 (link tr·ª±c ti·∫øp t∆∞∆°ng ƒë∆∞∆°ng t·ª´ mirror)
          sudo aria2c -s16 -x16 -o android.iso https://mirror.math.princeton.edu/pub/android-x86/9.0-r2/android-x86_64-9.0-r2-k49.iso

          # t·∫°o ·ªï c·ª©ng ·∫£o ƒë·ªÉ c√†i Android (tr√°nh l·ªói No bootable device)
          sudo qemu-img create -f qcow2 /mnt/android_disk.qcow2 70G

      - name: Launch Android-x86 in QEMU with VNC and noVNC
        run: |
          # kh·ªüi ƒë·ªông noVNC (truy c·∫≠p qua c·ªïng 6080)
          websockify --web /usr/share/novnc/ --wrap-mode=ignore 6080 localhost:5900 &

          sleep 3
          sudo vncserver -SecurityTypes None &

          # ch·∫°y Android-x86 qua QEMU
          sudo qemu-system-x86_64 \
            -m 4096 \
            -smp 2 \
            -boot d \
            -cdrom android.iso \
            -hda /mnt/android_disk.qcow2 \
            -vga virtio \
            -display vnc=:0 \
            -enable-kvm &

          echo "‚úÖ Android-x86 ƒëang kh·ªüi ƒë·ªông..."
          echo "üåê M·ªü noVNC t·∫°i: http://localhost:6080/vnc.html"
          sleep infinity
